<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ´¥ç”°ã®æ™‚ç³»åˆ—ä¸¦ã³æ›¿ãˆã‚¯ã‚¤ã‚º</title>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 16px;
      background: #f5f5f5;
    }
    h1 { text-align: center; }

    input {
      display: block;
      margin: 12px auto;
      padding: 8px;
      font-size: 16px;
      width: 240px;
    }

    #guide {
      display: flex;
      justify-content: space-between;
      max-width: 1000px;
      margin: 0 auto 12px;
      font-weight: bold;
    }

    #quiz {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .item {
      background: white;
      border: 2px solid #ccc;
      border-radius: 8px;
      padding: 8px;
      cursor: grab;
    }

    .item.dragging { opacity: 0.5; }

    .item img {
      max-width: 160px;
      border-radius: 4px;
    }

    button {
      display: block;
      margin: 24px auto;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background: #1976d2;
      color: white;
    }

    .item.correct {
      border: 3px solid red;
    }

    #result {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      white-space: pre-line;
      margin-top: 12px;
    }

    #correct-images {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 16px;
    }

    .correct-item {
      background: white;
      border: 2px solid #4caf50;
      border-radius: 8px;
      padding: 6px;
      text-align: center;
      font-size: 12px;
    }

    .correct-item img {
      max-width: 140px;
      display: block;
      margin-bottom: 4px;
      border-radius: 4px;
    }


  </style>
</head>
<body>

<h1>ã„ã£ã¡ãƒ¼æ™‚ç³»åˆ—ä¸¦ã³æ›¿ãˆã‚¯ã‚¤ã‚º</h1>

<input id="nickname" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›">

<p style="text-align:center">
  å†™çœŸã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦æ­£ã—ã„æ™‚ç³»åˆ—ã«ä¸¦ã³æ›¿ãˆã¦ãã ã•ã„ã€‚
</p>

<div id="guide">
  <span>â† å¤ã„</span>
  <span>æ–°ã—ã„ â†’</span>
</div>

<div id="quiz"></div>

<button id="check">åˆ¤å®š</button>

<div id="result"></div>
<div id="correct-images"></div>

<script>
  // ===== ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ =====
  const PASSWORD = "0811"; // â† ã“ã“ã‚’å¤‰æ›´

  const input = prompt("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

  if (input !== PASSWORD) {
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
    document.body.innerHTML = "";
    throw new Error("Unauthorized");
  }

  // ğŸ”‘ Public Key ã‚’å…¥ã‚Œã‚‹
  emailjs.init("7UqILhDVTAely1Yk4");

  const correctOrder = [1, 2, 3, 4, 5, 6];

  const images = [
    { id: 1, src: './img_ichirou/20200829.jpg' },
    { id: 2, src: './img_ichirou/20211229.jpg' },
    { id: 3, src: './img_ichirou/20230311.jpg' },
    { id: 4, src: './img_ichirou/20231223.jpg' },
    { id: 5, src: './img_ichirou/20241230.jpg' },
    { id: 6, src: './img_ichirou/20251231.jpg' }
  ];

  images.sort(() => Math.random() - 0.5);

  const quiz = document.getElementById('quiz');
  let dragItem = null;

  images.forEach(img => {
    const div = document.createElement('div');
    div.className = 'item';
    div.draggable = true;
    div.dataset.id = img.id;

    const image = document.createElement('img');
    image.src = img.src;

    div.appendChild(image);
    quiz.appendChild(div);

    div.addEventListener('dragstart', () => dragItem = div);
    div.addEventListener('dragover', e => e.preventDefault());
    div.addEventListener('drop', () => {
      if (dragItem && dragItem !== div) {
        const items = [...quiz.children];
        quiz.insertBefore(
          dragItem,
          items.indexOf(dragItem) < items.indexOf(div) ? div.nextSibling : div
        );
      }
    });
  });

  document.getElementById('check').addEventListener('click', () => {
    const nickname = document.getElementById('nickname').value.trim();
    if (!nickname) {
      alert('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }

    const items = [...quiz.children];
    const current = items.map(el => Number(el.dataset.id));

    let correctCount = 0;

    // ä¸€åº¦ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆ
    items.forEach(el => el.classList.remove('correct'));

    items.forEach((el, index) => {
      const id = Number(el.dataset.id);
      if (id === correctOrder[index]) {
        correctCount++;
        el.classList.add('correct'); // â† èµ¤æ 
      }
    });

    const userOrderText = current.map(id =>
      images.find(img => img.id === id).src.split('/').pop()
    ).join(' â†’ ');

    const correctOrderText = correctOrder.map(id =>
      images.find(img => img.id === id).src.split('/').pop()
    ).join(' â†’ ');

    document.getElementById('result').textContent =
      `ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼š${nickname}\n` +
      `ä¸€è‡´æ•°ï¼š${correctCount} / ${correctOrder.length}\n\n` +
      //`ã‚ãªãŸã®ä¸¦ã³:\n${userOrderText}\n\n` +
      `æ­£ã—ã„ä¸¦ã³:\n${correctOrderText}`;

    // æ­£è§£ç”»åƒè¡¨ç¤º
    const correctImages = document.getElementById('correct-images');
    correctImages.innerHTML = '';
    correctOrder.forEach(id => {
      const imgData = images.find(i => i.id === id);
      const d = document.createElement('div');
      d.className = 'correct-item';
      d.innerHTML = `<img src="${imgData.src}"><div>${imgData.src.split('/').pop()}</div>`;
      correctImages.appendChild(d);
    });

    /*
    emailjs.send(
      "service_wozej6k",
      "template_rymexab",
      {
        nickname: "ãƒ†ã‚¹ãƒˆé€ä¿¡"
      }
    )
    .then(function(response) {
      alert("é€ä¿¡æˆåŠŸ: " + JSON.stringify(response));
    })
    .catch(function(error) {
      alert("é€ä¿¡å¤±æ•—: " + JSON.stringify(error));
      console.error(error);
    });*/


    
    // ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    emailjs.send(
      "service_wozej6k",
      "template_rymexab",
      {
        nickname: nickname,
        score: `${correctCount} / ${correctOrder.length}`,
        user_order: userOrderText,
        correct_order: correctOrderText
      }
    );
    
  });
</script>

</body>
</html>
